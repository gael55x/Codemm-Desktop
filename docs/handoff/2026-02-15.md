# Handoff: 2026-02-15

## Summary

- Improved app launch UX: the startup splash now includes deterministic progress bars and status text instead of a static “Launching…” screen.
- Pivoted generation + UX to stdout-only checking (no return/mixed modes) to better align with console-output-focused pedagogy and reduce generator thrash.

## Iteration Log

### Iteration 1 (Startup Splash Progress)

- Added progress bars to the Electron startup splash and updated them across boot phases (deps, Docker judge, engine, UI) (`apps/ide/main.js`).

### Iteration 2 (Splash Simplification)

- Simplified the startup splash to a single progress bar with a changing status line (still stage-driven/deterministic) (`apps/ide/main.js`).

### Iteration 3 (Java Generation Stability)

- Fixed Java class/test name inference to prefer the top-level public class, and hardened Java reference-solution repair to re-validate deterministic invariants (reduces compile-time failures for multi-class OOP problems) (`apps/backend/src/utils/javaCodegen.ts`, `apps/backend/src/languages/java/judge.ts`, `apps/backend/src/generation/perSlotGenerator.ts`).

### Iteration 4 (Generation Evidence Events + Obligations IR)

- Added an internal obligations IR and a new `slot_evidence` generation progress event that records deterministic, non-sensitive evidence (obligation IDs + pass/fail) for each slot attempt (`apps/backend/src/generation/obligations.ts`, `apps/backend/src/generation/index.ts`, `apps/backend/src/contracts/generationProgress.ts`, `apps/frontend/src/types/generationProgress.ts`).

### Iteration 5 (Java Deterministic Rewriters + IO Contract)

- Added deterministic Java rewrite passes to reduce retry thrash (demote extra top-level `public` types; rename mismatched JUnit test class to the expected `${Target}Test`) and enforced a deterministic no-stdin contract for non-interactive styles (rejects `System.in`/`Scanner` usage) (`apps/backend/src/utils/javaSource.ts`, `apps/backend/src/utils/javaRewrite.ts`, `apps/backend/src/generation/perSlotGenerator.ts`).

### Iteration 6 (Retry Dedup: Skip Re-validating Identical Artifacts)

- Added a deterministic expensive-validation dedupe guard: if a retry produces identical reference artifacts + `test_suite`, Codemm skips re-running Docker validation / quality gates and replays the last failure for that fingerprint (`apps/backend/src/generation/index.ts`).

### Iteration 7 (Stdout-Only Checking Mode + Java Stdout Contract)

- Made the product checking mode stdout-only end-to-end: spec is deterministically coerced to `problem_style=stdout`, the UI no longer asks users to choose between return/stdout/mixed, and fallback no longer “switches to return” (`apps/backend/src/compiler/specDraft.ts`, `apps/backend/src/services/dialogueService.ts`, `apps/backend/src/agent/specAnalysis.ts`, `apps/backend/src/services/sessionService.ts`, `apps/frontend/src/lib/specBuilderUx.ts`, `apps/backend/src/agent/generationFallback.ts`).
- Strengthened Java stdout correctness: reference solutions must print, tests must capture stdout, missing/mismatched samples are auto-filled deterministically, and generation deterministically promotes a single top-level type to `public` when models omit it (`apps/backend/src/generation/perSlotGenerator.ts`, `apps/backend/src/languages/java/rules.ts`, `apps/backend/src/utils/javaRewrite.ts`, `apps/backend/src/utils/javaSource.ts`).
- Updated e2e/integration coverage to stdout-only across languages and updated the frontend Python `main.py` template to avoid auto-printing return values (aligns the editor “Run” experience with stdout-only checking) (`apps/backend/test/integration/*`, `apps/frontend/src/lib/languages/python.ts`).

### Iteration 8 (Java stdin-aware generation + sample-driven tests)

- Added a deterministic sample-driven JUnit generator for stdin-driven Java programs: if the reference solution reads stdin (Scanner/System.in) and provides 8+ sample_inputs, Codemm executes the reference in Docker to derive expected stdout and rebuilds the `test_suite` accordingly (prevents “No line found” failures from missing stdin setup) (`apps/backend/src/languages/java/sampleDrivenTests.ts`, `apps/backend/src/generation/perSlotGenerator.ts`).
- Tightened Java OOP reliability: structural-topic slots now deterministically reject stdin-driven drafts (forces method-based OOP designs), and the encapsulation/composition validator no longer misclassifies method bodies as public fields and ignores `Main` when selecting the primary domain class (`apps/backend/src/languages/java/structuralTopics.ts`, `apps/backend/src/generation/perSlotGenerator.ts`).

## How to Run

- Dev: `npm run dev`

## Known Issues / Next

- Progress is coarse stage-based (deterministic) rather than log-derived per-Docker-step progress.
